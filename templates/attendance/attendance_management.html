{% extends "layout.html" %}
{% block title %}Attendance Management{% endblock %}
{% block content %}
    {% include "navbar.html" %}
    <div class="flex flex-col items-center px-4 2xl:px-0 pt-6 xl:gap-4 dark:bg-gray-900">
        <div class="w-full relative px-2 lg:px-10">
            <div class="flex flex-row justify-between">
                <h1 class="text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white py-3 mt-10">Attendance Management</h1>
                <div class="flex flex-col md:flex-row mt-12 p-1 gap-1">
                    <button type="button"
                            hx-get="{% url "attendance:request_swap" %}"
                            class="inline-flex items-center justify-center w-auto max-w-sm px-3 py-2 text-sm font-medium text-center text-gray-900 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-700">
                        Request Swap
                    </button>
                    <button type="button"
                            hx-get="{% url "attendance:request_overtime" %}"
                            class="inline-flex items-center justify-center w-auto max-w-sm px-3 py-2 text-sm font-medium text-center text-gray-900 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-700">
                        Request Overtime
                    </button>
                </div>
            </div>
            {% block attendance_management_section %}
                <div id="attendance_management_section"
                     class="flex flex-col gap-6 p-4 mb-4 bg-white border border-gray-200 rounded-lg shadow-sm 2xl:col-span-2 dark:border-gray-700 sm:p-6 dark:bg-gray-800">
                    <div class="w-full flex flex-col sm:flex-row gap-2">
                        <div class="w-full items-center sm:flex sm:divide-x sm:divide-gray-100 sm:mb-0 dark:divide-gray-700">
                            <div class="max-w-sm flex sm:flex-row justify-items-start gap-2">
                                <div class="max-w-sm">
                                    <label for="attendance_year"
                                           class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Year
                                    </label>
                                    <input id="attendance_year"
                                           name="attendance_year"
                                           type="number"
                                           class="w-20 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                           min="2024"
                                           hx-post="{% url "attendance:attendance_management" %}"
                                           value="{{ selected_year }}"
                                           hx-trigger="input changed delay:200ms"
                                           hx-include="[name='attendance_month']">
                                </div>
                                <div class="max-w-sm">
                                    <label for="attendance_month"
                                           class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                        Month
                                    </label>
                                    <select id="attendance_month"
                                            name="attendance_month"
                                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                            hx-post="{% url "attendance:attendance_management" %}"
                                            hx-trigger="change"
                                            hx-include="[name='attendance_year']">
                                        {% for month in list_of_months %}
                                            <option value="{{ month.1 }}"
                                                    {% if selected_month == month.1 %}selected{% endif %}>
                                                {{ month.0 }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center w-full justify-start sm:justify-end gap-2">
                            <button type="button"
                                    hx-post="{% url "attendance:sync_user_attendance" %}"
                                    hx-swap="none"
                                    hx-include="[name='attendance_year'], [name='attendance_month']"
                                    class="inline-flex items-center justify-center w-auto max-w-sm px-3 py-2 text-sm font-medium text-center text-gray-900 bg-white border border-gray-300 rounded-lg hover:bg-gray-100 focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-gray-700">
                                <svg class="w-5 h-5 mr-2 -ml-1"
                                     fill="currentColor"
                                     viewBox="0 0 20 20"
                                     xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd">
                                    </path>
                                </svg>
                                Sync Attendance
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <div class="inline-block min-w-full align-middle">
                            <div class="overflow-hidden shadow">
                                {% block user_attendance_table %}
                                    <table id="user_attendance_table"
                                           class="min-w-full divide-y divide-gray-200 table-fixed dark:divide-gray-600">
                                        <thead class="bg-gray-100 dark:bg-gray-700">
                                            <tr>
                                                <th scope="col"
                                                    class="p-4 text-xs font-medium text-left text-gray-500 uppercase dark:text-gray-400">
                                                    Day
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-xs font-medium text-left text-gray-500 uppercase dark:text-gray-400">
                                                    Shift
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-xs font-medium text-left text-gray-500 uppercase dark:text-gray-400">
                                                    Time In
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-xs font-medium text-left text-gray-500 uppercase dark:text-gray-400">
                                                    Time Out
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-xs font-medium text-gray-500 uppercase dark:text-gray-400 text-center">
                                                    Holiday
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-xs font-medium text-gray-500 uppercase dark:text-gray-400 text-center">
                                                    Overtime
                                                </th>
                                                <th scope="col"
                                                    class="p-4 text-xs font-medium text-gray-500 uppercase dark:text-gray-400 text-center">
                                                    On Leave
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700">
                                            {% for user_shift_data in monthly_record_data %}
                                                {% block user_table_record %}
                                                    <tr class="hover:bg-gray-100 dark:hover:bg-gray-700">
                                                        <td class="flex items-center p-4 mr-12 space-x-6 whitespace-nowrap">
                                                            <div class="text-sm font-normal text-gray-500 dark:text-gray-400">
                                                                <div class="text-base font-semibold text-gray-900 dark:text-white">{{ user_shift_data.day }}</div>
                                                                <p class="text-gray-500 dark:text-gray-400">{{ user_shift_data.day_name }}</p>
                                                            </div>
                                                        </td>
                                                        <td class="max-w-sm p-4 overflow-hidden text-base font-bold text-gray-500 truncate xl:max-w-xs dark:text-gray-400">
                                                            <div class="text-sm font-normal text-gray-500 dark:text-gray-400">
                                                                <div class="text-base font-semibold text-gray-900 dark:text-white">
                                                                    {{ user_shift_data.daily_user_shift.shift.description }}
                                                                </div>
                                                                <div class="text-sm font-semibold text-gray-500 dark:text-gray-400">
                                                                    {{ user_shift_data.daily_user_shift.shift.get_twelve_hour_format_shift_range }}
                                                                </div>
                                                                {% if user_shift_data.daily_user_shift.shift.get_twelve_hour_format_second_shift_range %}
                                                                    <div class="text-sm font-semibold text-gray-500 dark:text-gray-400">
                                                                        {{ user_shift_data.daily_user_shift.shift.get_twelve_hour_format_second_shift_range }}
                                                                    </div>
                                                                {% endif %}
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="flex flex-col p-4 whitespace-nowrap text-center">
                                                                {% for data in user_shift_data.clocked_time_data.IN %}
                                                                    <p class="text-base font-medium text-gray-900 dark:text-white">{{ data.get_localtime_time|date:"h:i a" }}</p>
                                                                {% endfor %}
                                                            </div>
                                                        </td>
                                                        <td>
                                                            <div class="flex flex-col p-4 whitespace-nowrap text-center">
                                                                {% for data in user_shift_data.clocked_time_data.OUT %}
                                                                    <p class="text-base font-medium text-gray-900 dark:text-white">{{ data.get_localtime_time|date:"h:i a" }}</p>
                                                                {% endfor %}
                                                            </div>
                                                        </td>
                                                        <td class="p-4 text-base font-medium text-gray-900 whitespace-nowrap dark:text-white text-center">
                                                            {% if user_shift_data.holidays %}
                                                                {% for holiday in user_shift_data.holidays %}{{ holiday.get_name_display }}{% endfor %}
                                                            {% endif %}
                                                        </td>
                                                        <td class="p-4 text-base font-medium text-gray-900 whitespace-nowrap dark:text-white text-center">
                                                            {% if user_shift_data.approved_overtime %}
                                                                <svg class="mx-auto w-6 h-6 text-gray-800 dark:text-white"
                                                                     aria-hidden="true"
                                                                     xmlns="http://www.w3.org/2000/svg"
                                                                     width="24"
                                                                     height="24"
                                                                     fill="none"
                                                                     viewBox="0 0 24 24">
                                                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11.917 9.724 16.5 19 7.5" />
                                                                </svg>
                                                            {% endif %}
                                                        </td>
                                                        <td class="p-4 text-base font-medium text-gray-900 whitespace-nowrap dark:text-white text-center">
                                                            {% if user_shift_data.approved_leave %}
                                                                <svg class="mx-auto w-6 h-6 text-gray-800 dark:text-white"
                                                                     aria-hidden="true"
                                                                     xmlns="http://www.w3.org/2000/svg"
                                                                     width="24"
                                                                     height="24"
                                                                     fill="none"
                                                                     viewBox="0 0 24 24">
                                                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11.917 9.724 16.5 19 7.5" />
                                                                </svg>
                                                                {% for leave in user_shift_data.approved_leave %}
                                                                    <p class="text-gray-500 dark:text-gray-400">{{ leave.get_type_display }}</p>
                                                                {% endfor %}
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                {% endblock %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% endblock %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endblock %}
        </div>
        <!-- Request Overtime Modal -->
        <div id="request_overtime_modal"
             tabindex="-1"
             aria-hidden="true"
             class="hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-auto max-h-full">
            {% block request_overtime_container %}
                <div id="request_overtime_container"
                     class="relative w-full max-w-4xl max-h-full">
                    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700 mx-4">
                        <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Request Overtime Settings</h3>
                            <button hx-post="{% url "attendance:attendance_module_close_modals" %}"
                                    hx-vals='{"event_name": "closeRequestOvertimeModal"}'
                                    type="button"
                                    class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white">
                                <svg class="w-3 h-3"
                                     aria-hidden="true"
                                     xmlns="http://www.w3.org/2000/svg"
                                     fill="none"
                                     viewBox="0 0 14 14">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                                </svg>
                            </button>
                        </div>
                        <div class="p-4 md:p-5">
                            <div class="flex flex-col gap-2">
                                <div>
                                    <div class="max-w-md mx-auto p-6 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                                        <form class="flex flex-col gap-2"
                                              hx-post="{% url "attendance:submit_overtime_request" %}">
                                            <div>
                                                <label for="overtime_date_id"
                                                       class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                                    Date
                                                </label>
                                                <div>
                                                    <input type="date"
                                                           id="overtime_date_id"
                                                           name="overtime_date"
                                                           class="w-full max-w-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                                           onfocus="let d = new Date(); d.setDate(d.getDate() + 1); this.min = d.toISOString().split('T')[0];"
                                                           required />
                                                </div>
                                            </div>
                                            <div>
                                                <label for="selected_approver_id"
                                                       class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                                    Select an Approver
                                                </label>
                                                <select id="selected_approver_id"
                                                        name="selected_approver"
                                                        class="w-full max-w-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                                        required>
                                                    <option selected value="">Choose an Approver</option>
                                                    {% for approver in approvers %}
                                                        <option value="{{ approver.id }}">{{ approver.userdetails.get_user_fullname|title }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="flex justify-center">
                                                <button type="submit"
                                                        class="inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                                                    Request
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                {% if overtime_requests %}
                                    <div class="h-[25rem] relative overflow-y-auto overflow-x-auto border shadow-md sm:rounded-lg">
                                        <div class="p-4 bg-white dark:bg-gray-900 sticky top-0">
                                            <div class="max-w-sm">
                                                <label for="selected_year_id"
                                                       class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                                    Filter By Year:
                                                </label>
                                                <select id="selected_year_id"
                                                        name="selected_year"
                                                        hx-get="{% url "attendance:request_overtime" %}"
                                                        hx-vals='{"year_filter": "True"}'
                                                        class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                                    <option selected value="0">All</option>
                                                    {% for year in overtime_years %}<option value="{{ year }}">{{ year }}</option>{% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                        {% block user_overtime_requests_table %}
                                            <table id="user_overtime_requests_table"
                                                   class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 sticky top-24">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">Date</th>
                                                        <th scope="col" class="px-6 py-3">Approver</th>
                                                        <th scope="col" class="px-6 py-3">Status</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for overtime_request in overtime_requests %}
                                                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                                            <th scope="row"
                                                                class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                                                {{ overtime_request.get_display_date }}
                                                            </th>
                                                            <td class="px-6 py-4">{{ overtime_request.get_approver_display }}</td>
                                                            <td class="px-6 py-4">{{ overtime_request.get_status_display }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% endblock %}
                                    </div>
                                {% endif %}
                                {% if not user.userdetails.role == "EMP" %}
                                    <div class="flex justify-center mt-5">
                                        <button type="button"
                                                hx-get="{% url "attendance:view_overtime_request_to_approve" %}"
                                                class="inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                                            View Requests To Approve
                                        </button>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endblock %}
        </div>
        <!-- Overtime Request To Approve Modal -->
        <div id="overtime_request_to_approve_modal"
             tabindex="-1"
             aria-hidden="true"
             class="hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-auto max-h-full">
            {% block overtime_request_to_approve_container %}
                <div id="overtime_request_to_approve_container"
                     class="relative w-full max-w-6xl max-h-full">
                    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700 mx-4">
                        <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                            <div class="flex flex-row gap-4">
                                <button hx-get="{% url "attendance:view_overtime_request_to_approve" %}"
                                        hx-vals='{"back": "true"}'>
                                    <svg class="w-6 h-6 text-gray-800 dark:text-white"
                                         aria-hidden="true"
                                         xmlns="http://www.w3.org/2000/svg"
                                         width="24"
                                         height="24"
                                         fill="none"
                                         viewBox="0 0 24 24">
                                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12l4-4m-4 4 4 4" />
                                    </svg>
                                </button>
                                <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Overtime Requests To Approve</h3>
                            </div>
                            <button hx-post="{% url "attendance:attendance_module_close_modals" %}"
                                    hx-vals='{"event_name": "closeOvertimeRequestsToApproveModal"}'
                                    type="button"
                                    class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white">
                                <svg class="w-3 h-3"
                                     aria-hidden="true"
                                     xmlns="http://www.w3.org/2000/svg"
                                     fill="none"
                                     viewBox="0 0 14 14">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                                </svg>
                            </button>
                        </div>
                        <div class="p-4 md:p-5">
                            <div class="h-[35rem] overflow-y-auto relative overflow-x-auto border shadow-md sm:rounded-lg">
                                <div class="p-4 bg-white dark:bg-gray-900 sticky top-0">
                                    <div class="max-w-sm">
                                        <label for="selected_year_id"
                                               class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                            Filter By Year:
                                        </label>
                                        <select id="selected_year_id"
                                                name="selected_year"
                                                hx-get="{% url "attendance:view_overtime_request_to_approve" %}"
                                                hx-vals='{"year_filter": "True"}'
                                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                            <option selected value="0">All</option>
                                            {% for year in overtime_years %}<option value="{{ year }}">{{ year }}</option>{% endfor %}
                                        </select>
                                    </div>
                                </div>
                                {% block overtime_requests_to_approve_table %}
                                    <table id="overtime_requests_to_approve_table"
                                           class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 sticky top-24">
                                            <tr>
                                                <th scope="col" class="px-6 py-3">Name</th>
                                                <th scope="col" class="px-6 py-3">Date</th>
                                                <th scope="col" class="px-6 py-3">Status</th>
                                                <th scope="col" class="px-6 py-3">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for overtime_request in requests_to_approve %}
                                                {% block specific_overtime_request_to_respond %}
                                                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                                        <th scope="row"
                                                            class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                                            {{ overtime_request.get_requestor_display }}
                                                        </th>
                                                        <td class="px-6 py-4">{{ overtime_request.get_display_date }}</td>
                                                        <td class="px-6 py-4">{{ overtime_request.get_status_display }}</td>
                                                        <td class="px-6 py-4">
                                                            {% if overtime_request.status == "PEND" %}
                                                                <button type="button"
                                                                        hx-post="{% url "attendance:respond_to_overtime_request" %}"
                                                                        hx-vals='{"overtime_request": {{ overtime_request.id }}, "response": "APPROVE"}'
                                                                        class="px-3 py-2 text-xs font-medium text-center text-white bg-green-700 rounded-lg hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800">
                                                                    Approve
                                                                </button>
                                                                <button type="button"
                                                                        hx-post="{% url "attendance:respond_to_overtime_request" %}"
                                                                        hx-vals='{"overtime_request": {{ overtime_request.id }}, "response": "REJECT"}'
                                                                        class="px-3 py-2 text-xs font-medium text-center text-white bg-red-700 rounded-lg hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900">
                                                                    Reject
                                                                </button>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                {% endblock %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                {% endblock %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endblock %}
        </div>
        <!-- Request Swap Modal -->
        <div id="request_swap_modal"
             tabindex="-1"
             aria-hidden="true"
             class="hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-auto max-h-full">
            {% block request_swap_modal_container %}
                <div id="request_swap_modal_container"
                     class="relative w-full max-w-6xl max-h-full">
                    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700 mx-4">
                        <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                            <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Request Swap</h3>
                            <button hx-post="{% url "attendance:attendance_module_close_modals" %}"
                                    hx-vals='{"event_name": "closeRequestSwapModal"}'
                                    type="button"
                                    class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white">
                                <svg class="w-3 h-3"
                                     aria-hidden="true"
                                     xmlns="http://www.w3.org/2000/svg"
                                     fill="none"
                                     viewBox="0 0 14 14">
                                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6" />
                                </svg>
                            </button>
                        </div>
                        <div class="p-4 md:p-5">
                            {% if not for_review_pending %}
                                <div>
                                    <div class="flex flex-col md:flex-row gap-2">
                                        <div class="w-full md:w-[30rem] p-6 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                                            <form hx-post="{% url 'attendance:submit_request_swap' %}">
                                                <div class="flex flex-col gap-2">
                                                    <div>
                                                        <label for="swap_date_id"
                                                               class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                                            Date:
                                                        </label>
                                                        <input type="date"
                                                               id="swap_date_id"
                                                               name="swap_date"
                                                               hx-get="{% url 'attendance:reload_request_swap_user_list' %}"
                                                               hx-trigger="change"
                                                               class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                                               placeholder="Flowbite"
                                                               required
                                                               onfocus="this.min = new Date().toISOString().split('T')[0];" />
                                                    </div>
                                                    {% block request_swap_user_shift_selection %}
                                                        <div id="request_swap_user_shift_selection">
                                                            <label for="shift_list"
                                                                   class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                                                User & Shift:
                                                            </label>
                                                            <select id="shift_list"
                                                                    name="selected_shift"
                                                                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                                                    required>
                                                                {% if shifts %}
                                                                    <option selected value="">Choose a user and shift</option>
                                                                    {% for shift in shifts %}
                                                                        <option value="{{ shift.id }}">
                                                                            {{ shift.user.userdetails.get_user_fullname|title }} - ({{ shift.shift.get_twelve_hour_format_shift_range }}
                                                                            {% if shift.shift.get_twelve_hour_format_second_shift_range %}
                                                                                {{ shift.shift.get_twelve_hour_format_second_shift_range }}
                                                                            {% endif %}
                                                                            )
                                                                        </option>
                                                                    {% endfor %}
                                                                {% else %}
                                                                    <option selected value="">No shifts available to swap</option>
                                                                {% endif %}
                                                            </select>
                                                        </div>
                                                    {% endblock %}
                                                    <div>
                                                        <label for="request_approver_id"
                                                               class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                                            Info:
                                                        </label>
                                                        <textarea type="text"
                                                                  name="swap_info"
                                                                  id="swap_info"
                                                                  required
                                                                  class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
                                                                  placeholder="Enter Swap Info..."></textarea>
                                                    </div>
                                                    <div>
                                                        <label for="request_approver_id"
                                                               class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                                            Approver:
                                                        </label>
                                                        <select id="request_approver_id"
                                                                name="selected_approver"
                                                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                                                required>
                                                            <option selected value="">Choose an approver</option>
                                                            {% for approver in approvers %}
                                                                <option value="{{ approver.id }}">{{ approver.userdetails.get_user_fullname|title }}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div class="flex justify-center mt-2">
                                                        <button type="submit"
                                                                class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                                                            Submit
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                        <div class="w-full h-[30rem] relative overflow-y-auto overflow-x-auto shadow-md sm:rounded-lg">
                                            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">Request To</th>
                                                        <th scope="col" class="px-6 py-3 text-center">From Shift</th>
                                                        <th scope="col" class="px-6 py-3 text-center">To Shift</th>
                                                        <th scope="col" class="px-6 py-3 text-center">Date</th>
                                                        <th scope="col" class="px-6 py-3 text-center">Info</th>
                                                        <th scope="col" class="px-6 py-3 text-center">Status</th>
                                                        <th scope="col" class="px-6 py-3"></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for swap_data in swap_requests %}
                                                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                                            <th scope="row"
                                                                class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white ">
                                                                {{ swap_data.requested_for.userdetails.get_user_fullname|title }}
                                                            </th>
                                                            <td class="px-6 py-4 text-center">{{ swap_data.current_shift.shift }}</td>
                                                            <td class="px-6 py-4 text-center">{{ swap_data.requested_shift.shift }}</td>
                                                            <td class="px-6 py-4 text-center">{{ swap_data.requested_shift.date }}</td>
                                                            <td class="px-6 py-4 text-center">{{ swap_data.info }}</td>
                                                            <td class="px-6 py-4 text-center">{{ swap_data.get_status }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    {% if not current_user.userdetails.is_employee %}
                                        <div class="flex justify-center w-full mt-2 p-2 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                                            <button type="button"
                                                    hx-get="{% url "attendance:request_swap" %}"
                                                    hx-vals='{"review_pending": "True"}'
                                                    class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                                                Review Pending Swap Request
                                            </button>
                                        </div>
                                    {% endif %}
                                </div>
                            {% else %}
                                <div>
                                    <div class="flex flex-col md:flex-row gap-2">
                                        <div class="w-full h-[30rem] p-2 relative overflow-y-auto overflow-x-auto shadow-md sm:rounded-lg">
                                            <form class="mb-2">
                                                <div class="flex flex-row gap-2">
                                                    <div>
                                                        <label for="existing_swap_user_id"
                                                               class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                                            User:
                                                        </label>
                                                        <select hx-get="{% url "attendance:request_swap" %}"
                                                                hx-vals='{"review_pending": "True"}'
                                                                hx-trigger="change"
                                                                hx-include="[name='request_swap_selected_year']"
                                                                id="existing_swap_user_id"
                                                                name="request_swap_selected_user"
                                                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                                            <option selected value="">Choose a User</option>
                                                            {% for user in involved_users %}
                                                                <option value="{{ user.id }}"
                                                                        {% if user.id == request_swap_selected_user %}selected{% endif %}>
                                                                    {{ user.userdetails.get_user_fullname|title }}
                                                                </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                    <div>
                                                        <label for="existing_swap_year_id"
                                                               class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                                                            Month - Year
                                                        </label>
                                                        <select hx-get="{% url "attendance:request_swap" %}"
                                                                hx-vals='{"review_pending": "True"}'
                                                                hx-trigger="change"
                                                                hx-include="[name='request_swap_selected_user']"
                                                                id="existing_swap_year_id"
                                                                name="request_swap_selected_year"
                                                                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                                                            <option selected value="">Choose a year</option>
                                                            {% for year in years %}
                                                                <option value="{{ year }}"
                                                                        {% if request_swap_selected_year == year %}selected{% endif %}>
                                                                    {{ year }}
                                                                </option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                            </form>
                                            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                                                <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                                    <tr>
                                                        <th scope="col" class="px-6 py-3">Requested By</th>
                                                        <th scope="col" class="px-6 py-3">Requested To</th>
                                                        <th scope="col" class="px-6 py-3 text-center">Date</th>
                                                        <th scope="col" class="px-6 py-3 text-center">Info</th>
                                                        <th scope="col" class="px-6 py-3 text-center">Status</th>
                                                        <th scope="col" class="px-6 py-3"></th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for swap_data in swap_requests %}
                                                        {% block swap_request_item %}
                                                            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                                                                <th scope="row" class="px-6 py-4">
                                                                    <div>
                                                                        <div class="text-base font-semibold">{{ swap_data.requested_by.userdetails.get_user_fullname|title }}</div>
                                                                        <div class="font-normal text-gray-500">{{ swap_data.current_shift.shift }}</div>
                                                                    </div>
                                                                </th>
                                                                <td class="px-6 py-4">
                                                                    <div>
                                                                        <div class="text-base font-semibold">{{ swap_data.requested_for.userdetails.get_user_fullname|title }}</div>
                                                                        <div class="font-normal text-gray-500">{{ swap_data.requested_shift.shift }}</div>
                                                                    </div>
                                                                </td>
                                                                <td class="px-6 py-4 text-center">{{ swap_data.requested_shift.date }}</td>
                                                                <td class="px-6 py-4 text-center">{{ swap_data.info }}</td>
                                                                <td class="px-6 py-4 text-center">{{ swap_data.get_status }}</td>
                                                                {% if not swap_data.has_approved_responded %}
                                                                    {% block shift_review_action_section %}
                                                                        {% if for_confirmation %}
                                                                            <td class="px-6 py-4 flex flex-col items-center">
                                                                                {% if for_approve %}
                                                                                    <div>
                                                                                        <button hx-post="{% url "attendance:respond_to_swap_request" %}"
                                                                                                hx-vals='{"request_swap": {{ swap_data.id }}, "swap_approved": "True"}'
                                                                                                type="button"
                                                                                                class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                                                                            Confirm Approval
                                                                                        </button>
                                                                                    </div>
                                                                                    <div>
                                                                                        <button hx-get="{% url "attendance:respond_to_swap_request" %}"
                                                                                                hx-vals='{"cancel": "True", "request_swap": {{ swap_data.id }}}'
                                                                                                type="button"
                                                                                                class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                                                                            Cancel
                                                                                        </button>
                                                                                    </div>
                                                                                {% elif for_reject %}
                                                                                    <div>
                                                                                        <button hx-post="{% url "attendance:respond_to_swap_request" %}"
                                                                                                hx-vals='{"request_swap": {{ swap_data.id }}, "swap_rejected": "True"}'
                                                                                                type="button"
                                                                                                class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                                                                            Confirm Rejection
                                                                                        </button>
                                                                                    </div>
                                                                                    <div>
                                                                                        <button hx-get="{% url "attendance:respond_to_swap_request" %}"
                                                                                                hx-vals='{"cancel": "True", "request_swap": {{ swap_data.id }}}'
                                                                                                type="button"
                                                                                                class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                                                                            Cancel
                                                                                        </button>
                                                                                    </div>
                                                                                {% endif %}
                                                                            </td>
                                                                        {% else %}
                                                                            <td class="px-6 py-4 flex flex-col items-center">
                                                                                <div>
                                                                                    <button hx-get="{% url "attendance:respond_to_swap_request" %}"
                                                                                            hx-vals='{"request_swap": {{ swap_data.id }}, "approve": "True"}'
                                                                                            type="button"
                                                                                            class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                                                                        Approve
                                                                                    </button>
                                                                                </div>
                                                                                <div>
                                                                                    <button hx-get="{% url "attendance:respond_to_swap_request" %}"
                                                                                            hx-vals='{"request_swap": {{ swap_data.id }}, "reject": "True"}'
                                                                                            type="button"
                                                                                            class="font-medium text-blue-600 dark:text-blue-500 hover:underline">
                                                                                        Reject
                                                                                    </button>
                                                                                </div>
                                                                            </td>
                                                                        {% endif %}
                                                                    {% endblock %}
                                                                {% endif %}
                                                            </tr>
                                                        {% endblock %}
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    {% if current_user.userdetails.is_department_head %}
                                        <div class="flex justify-center w-full mt-2 p-2 bg-white border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700">
                                            <button type="button"
                                                    hx-get="{% url "attendance:request_swap" %}"
                                                    class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">
                                                Return to Your Swap Requests
                                            </button>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endblock %}
        </div>
    </div>
{% endblock %}
{% block javascript %}
    <script>
        htmx.onLoad(function(content) {
            const reloadRequestSwapContent = () => {
                htmx.ajax('GET', '{% url "attendance:request_swap" %}', {
                    values: {}
                });
            };

            // Initialize specific modals
            const initializeRequestOvertimeModal = () => initializeModal('request_overtime_modal');
            const closeRequestOvertimeModal = () => closeModal('request_overtime_modal');
            const initializeOvertimeRequestsToApproveModal = () => initializeModal('overtime_request_to_approve_modal');
            const closeOvertimeRequestsToApproveModal = () => closeModal('overtime_request_to_approve_modal');
            const initializeRequestSwapModal = () => initializeModal('request_swap_modal');
            const closeRequestSwapModal = () => closeModal('request_swap_modal');

            // Event listeners for modals
            content.addEventListener('openRequestOvertimeModal', initializeRequestOvertimeModal);
            content.addEventListener('closeRequestOvertimeModal', closeRequestOvertimeModal);
            content.addEventListener('openOvertimeRequestsToApproveModal', initializeOvertimeRequestsToApproveModal);
            content.addEventListener('closeOvertimeRequestsToApproveModal', closeOvertimeRequestsToApproveModal);
            content.addEventListener('openRequestSwapModal', initializeRequestSwapModal);
            content.addEventListener('closeRequestSwapModal', closeRequestSwapModal);

            document.addEventListener('reloadRequestSwapContent', () => {
                reloadRequestSwapContent();
            });
        });
    </script>
{% endblock %}
