{% extends "layout.html" %}
{% block title %}
    Years of Experience Report - ({{ as_of_date }})
{% endblock title %}
{% block content %}
    <div class="w-[65rem] mx-auto p-6">
        <div>
            <input type="hidden"
                   id="years_of_experience_report_data"
                   value="{{ chart_option_data }}">
            <div class="w-full bg-white rounded-lg border shadow dark:bg-gray-800 p-3 md:p-4">
                <div class="flex justify-between border-gray-200 border-b dark:border-gray-700 pb-3">
                    <dl>
                        <dt class="text-xl font-normal text-gray-500 dark:text-gray-400 pb-1">
                            Years of Experience Report for as of <b>{{ as_of_date }}</b>
                        </dt>
                    </dl>
                    <dl>
                        <dt class="text-base font-normal text-gray-500 dark:text-gray-400 pb-1">Average Years of Service</dt>
                        <dd class="leading-none text-xl font-bold text-green-500 dark:text-green-400">
                            {{ years_of_experience_average }} year/s
                        </dd>
                    </dl>
                </div>
                {% if option == "all" or option == "table" %}
                    <div class="relative overflow-x-auto border-b-2">
                        <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-start">Name</th>
                                    <th scope="col" class="px-6 py-3 text-center">Years of Experience</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for data in years_of_expernce_tabe_data.users %}
                                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                                        <td class="px-6 py-4 text-start">{{ data.get_user_fullname|title }}</td>
                                        <td class="px-6 py-4 text-center">
                                            {% if data.get_years_and_months_in_service.0 or data.get_years_and_months_in_service.1 %}
                                                Length of Service: <u>
                                                {% with years=data.get_years_and_months_in_service.0 %}
                                                    {% with months=data.get_years_and_months_in_service.1 %}
                                                        {% if years %}{{ years }} {{ years|pluralize:"year,years" }}{% endif %}
                                                        {% if months %}{{ months }} {{ months|pluralize:"month,months" }}{% endif %}
                                                    {% endwith %}
                                                {% endwith %}
                                            </u>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
            {% if option == "all" or option == "chart" %}
                <div id="bar-chart"></div>
                <script>
                    var yearsOfExperienceReportChartOptions = () => {
                        const inputElement = document.getElementById('years_of_experience_report_data');
                        const inputValue = inputElement.value;
                        let parsedArray = {};

                        if (inputValue) {
                            parsedArray = JSON.parse(inputValue);
                        }

                        const yearsOfExperience = parsedArray.years_of_experience_group_list;
                        const yearsOfExperienceCount = parsedArray.years_of_experience_count_group_list;

                        return {
                            series: [{
                                name: "Experience",
                                color: "#31C48D",
                                data: yearsOfExperienceCount,
                            }],
                            chart: {
                                sparkline: {
                                    enabled: false,
                                },
                                type: "bar",
                                width: "100%",
                                height: 400,
                                toolbar: {
                                    show: false,
                                }
                            },
                            fill: {
                                opacity: 1,
                            },
                            plotOptions: {
                                bar: {
                                    horizontal: true,
                                    columnWidth: "100%",
                                    borderRadiusApplication: "end",
                                    borderRadius: 6,
                                    dataLabels: {
                                        position: "top",
                                    },
                                },
                            },
                            legend: {
                                show: true,
                                position: "bottom",
                            },
                            dataLabels: {
                                enabled: true,
                                formatter: function(val) {
                                    return val;
                                },
                                offsetX: -25,
                            },
                            tooltip: {
                                enabled: false,
                            },
                            xaxis: {
                                labels: {
                                    show: true,
                                    style: {
                                        fontFamily: "Inter, sans-serif",
                                        cssClass: 'text-xs font-normal fill-gray-500 dark:fill-gray-400'
                                    },
                                    formatter: function(value) {
                                        return value;
                                    }
                                },
                                categories: yearsOfExperience,
                                axisTicks: {
                                    show: false,
                                },
                                axisBorder: {
                                    show: false,
                                },
                            },
                            yaxis: {
                                labels: {
                                    show: true,
                                    style: {
                                        fontFamily: "Inter, sans-serif",
                                        cssClass: 'text-xs font-normal fill-gray-500 dark:fill-gray-400'
                                    },
                                    formatter: function(value) {
                                        return value + " year/s";
                                    }
                                }
                            },
                            grid: {
                                show: true,
                                strokeDashArray: 4,
                                padding: {
                                    left: 2,
                                    right: 2,
                                    top: -20
                                },
                            },
                            fill: {
                                opacity: 1,
                            }
                        }
                    }

                    if (document.getElementById("bar-chart") && typeof ApexCharts !== 'undefined') {
                        if (window.yearsOfExperienceReportChart) {
                            window.yearsOfExperienceReportChart.destroy();
                        }
                        window.yearsOfExperienceReportChart = new ApexCharts(document.getElementById("bar-chart"), yearsOfExperienceReportChartOptions());
                        window.yearsOfExperienceReportChart.render();
                    }
                </script>
            {% endif %}
        </div>
        <div class="w-full flex flex-col items-center justify-center mt-2 gap-2">
            {% if not hide_print_download_button and not for_print_download %}
                <p class="text-xl text-gray-900 whitespace-nowrap dark:text-white">Print/Download</p>
                <div class="inline-flex rounded-md shadow-sm" role="group">
                    <button type="button"
                            hx-post="{% url "reports_and_analytics:popup_years_of_experience_report" %}"
                            hx-vals='{"as_of_date": "{{ as_of_date }}", "option": "all"}'
                            class="px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 rounded-s-lg hover:bg-gray-900 hover:text-white focus:z-10 focus:ring-2 focus:ring-gray-500 focus:bg-gray-900 focus:text-white dark:border-white dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:bg-gray-700">
                        All
                    </button>
                    <button type="button"
                            hx-post="{% url "reports_and_analytics:popup_years_of_experience_report" %}"
                            hx-vals='{"as_of_date": "{{ as_of_date }}", "option": "table"}'
                            class="px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border-t border-b border-gray-900 hover:bg-gray-900 hover:text-white focus:z-10 focus:ring-2 focus:ring-gray-500 focus:bg-gray-900 focus:text-white dark:border-white dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:bg-gray-700">
                        Table
                    </button>
                    <button type="button"
                            hx-post="{% url "reports_and_analytics:popup_years_of_experience_report" %}"
                            hx-vals='{"as_of_date": "{{ as_of_date }}", "option": "chart"}'
                            class="px-4 py-2 text-sm font-medium text-gray-900 bg-transparent border border-gray-900 rounded-e-lg hover:bg-gray-900 hover:text-white focus:z-10 focus:ring-2 focus:ring-gray-500 focus:bg-gray-900 focus:text-white dark:border-white dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:bg-gray-700">
                        Chart
                    </button>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
