{% block conversation_window %}
    <div id="conversation_window"
         class="fixed right-5 top-20 p-4 min-w-[25rem] bg-white border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 sm:p-6 dark:bg-gray-800">
        <div class="flex flex-row justify-between border-b border-gray-200 dark:border-gray-600 mb-2">
            <button class="flex"
                    hx-get="{% url "chat:toggle_chat_window" True %}"
                    hx-vals='{"back": "True"}'>
                <svg class="w-5 h-5 mt-2"
                     data-name="Layer 1"
                     xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 16 16">
                    <path d="M11.62 3.81 7.43 8l4.19 4.19-1.53 1.52L4.38 8l5.71-5.71 1.53 1.52z" />
                </svg>
            </button>
            <h3 class="flex items-center mb-2 text-lg font-semibold text-gray-900 dark:text-white">
                {{ selected_user.get_full_name|title }}
            </h3>
            <button class="flex" hx-get="{% url "chat:toggle_chat_window" False %}">
                <svg xmlns="http://www.w3.org/2000/svg"
                     class="w-5 h-5 mt-2"
                     viewBox="0 0 25 25">
                    <path d="m2.828 17.828 6.086-6.086L15 17.828 17.828 15l-6.086-6.086 6.086-6.086L15 0 8.914 6.086 2.828 0 0 2.828l6.085 6.086L0 15l2.828 2.828z" />
                </svg>
            </button>
        </div>
        <div id="conversation_window_content" class="flex flex-col gap-1 w-full">
            {% if conversation %}
                <div id="scrollable_conversation_container"
                     class="z-10 bg-white shadow w-full dark:bg-gray-700 h-96 overflow-y-scroll w-full flex flex-col gap-1 rounded-md">
                    {% for message in conversation %}
                        <div class="w-full flex {% if message.sender == current_user %}justify-end{% endif %}">
                            <div class="rounded-lg w-96 max-w-[50%] px-2 mx-1 text-gray-800 break-words {% if message.sender == current_user %}bg-blue-50 dark:bg-gray-800 dark:text-blue-400{% else %}bg-gray-100 dark:bg-gray-800 dark:text-gray-300{% endif %} {% if forloop.last %}mb-2{% endif %}">
                                {{ message.message }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="w-full text-center font-semibold text-gray-900 dark:text-white">Send a message</div>
            {% endif %}
            <form class="flex items-center mx-auto"
                  hx-post="{% url "chat:send_chat_message" %}"
                  hx-vals='{"selected_user": {{ selected_user.id }}}'>
                <textarea name="chat_message"
                          placeholder="Message"
                          class="w-96 bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"></textarea>
                <button type="submit"
                        class="p-2.5 ms-2 text-sm font-medium text-white bg-blue-700 rounded-lg border border-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
                    <svg class="w-4 h-4"
                         xmlns="http://www.w3.org/2000/svg"
                         viewBox="0 0 24 24"
                         fill="white">
                        <path d="m20.447 11.105-16-8A1 1 0 0 0 3.152 4.53L7.82 12l-4.668 7.47a1 1 0 0 0 1.3 1.425l16-8a1 1 0 0 0 0-1.79zM6.731 17.517 9.554 13H12a1 1 0 0 0 0-2H9.554L6.731 6.483 17.764 12z" stroke="currentColor" />
                    </svg>
                </button>
            </form>
        </div>
    </div>
    {% block javascript %}
        <script>
            document.addEventListener("htmx:afterSettle", function() {
                const scrollableDiv = document.getElementById('scrollable_conversation_container');
                if (scrollableDiv) {
                    scrollableDiv.scrollTop = scrollableDiv.scrollHeight;
                }
            });
        </script>
    {% endblock %}
{% endblock %}
